<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KCF¬†Technologies¬†‚Äî¬†Search</title>
  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  BASIC STYLES  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <style>
    :root {
      --kcf-blue: #003e6b;
      --kcf-accent: #00aeef;
    }
    * {box-sizing:border-box;}
    body {
      margin:0;
      font-family:"Inter", "Helvetica Neue", Arial, sans-serif;
      background:#fff;
      color:#1a1d1f;
      line-height:1.45;
    }
    /* Full‚Äëwidth header image */
    .hero-img{display:block;width:100%;height:auto;object-fit:cover;}

    /* Header */
    header{
      background:var(--kcf-blue);
      padding:20px clamp(16px,5vw,64px);
      display:flex;
      align-items:center;
      gap:40px;
      flex-wrap:wrap;
    }
    header a.logo{
      display:flex;
      align-items:center;
      color:#fff;
      font-size:24px;
      font-weight:600;
      text-decoration:none;
    }
    /* Search bar */
    form#searchForm{
      flex:1 1 480px;
      position:relative;
    }
    #queryInput{
      width:100%;
      padding:14px 48px 14px 20px;
      border-radius:8px;
      border:none;
      font-size:18px;
    }
    #searchBtn{
      position:absolute;right:12px;top:50%;transform:translateY(-50%);
      border:none;background:none;color:#444;cursor:pointer;font-size:20px;
    }
    /* Layout */
    .wrap{display:grid;grid-template-columns:1fr 280px;gap:48px;padding:40px clamp(16px,5vw,64px);max-width:1400px;margin:0 auto;}
    @media(max-width:1023px){.wrap{grid-template-columns:1fr;}}

    /* Answer card */
    #answerCard{
      border:1px solid var(--kcf-blue);
      border-radius:6px;
      padding:24px;
      margin-bottom:32px;
    }
    #answerCard h2{margin-top:0;color:var(--kcf-blue);font-size:24px;}
    #sources{list-style:none;padding:0;margin:16px 0 0 0;}
    #sources li{margin-bottom:4px;}
    #sources a{color:var(--kcf-accent);text-decoration:none;}
    .feedbackBtn{border:none;background:none;cursor:pointer;font-size:22px;margin-right:6px;}

    /* Results */
    #results{list-style:none;padding:0;margin:0;}
    .result{padding:16px 0;border-bottom:1px solid #e5e8f0;}
    .result a.title{font-weight:600;color:var(--kcf-blue);font-size:20px;text-decoration:none;}
    .snippet{margin-top:4px;font-size:15px;color:#444;}

    /* CTA rail */
    aside.cta{
      display:flex;flex-direction:column;gap:16px;
      border:1px solid #e5e8f0;border-radius:6px;padding:24px;
    }
    aside.cta h3{margin:0 0 8px 0;font-size:22px;color:var(--kcf-blue);}
    .btn-demo{border:2px solid var(--kcf-blue);background:none;padding:10px 20px;border-radius:6px;font-weight:600;cursor:pointer;}
    @media(max-width:1023px){aside.cta{display:none;}}
  </style>
</head>
<body>
  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  FULL‚ÄëWIDTH BRAND IMAGE  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <img src="kcf header.jpg" alt="KCF Technologies visual header" class="hero-img" />

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  HEADER NAV + SEARCH  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <header>
    <a href="/" class="logo">KCF</a>
    <form id="searchForm" role="search">
      <input id="queryInput" type="search" placeholder="Search machine‚Äëhealth topics‚Ä¶" />
      <button id="searchBtn" aria-label="search">üîç</button>
    </form>
  </header>

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  MAIN WRAP  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <section class="wrap">
    <main>
      <article id="answerCard" hidden>
        <h2 id="answerHeading"></h2>
        <div id="answerBody"></div>
        <ul id="sources"></ul>
        <div id="feedback" style="margin-top:12px;">
          Helpful?
          <button class="feedbackBtn" data-val="1">üëç</button>
          <button class="feedbackBtn" data-val="-1">üëé</button>
        </div>
      </article>
      <ol id="results"></ol>
      <button id="loadMore" class="btn-demo" style="display:none;">Load more results</button>
    </main>

    <aside class="cta">
      <h3>Talk¬†to¬†an¬†expert</h3>
      <p>Contact us for more information or to schedule a demo.</p>
      <button class="btn-demo" onclick="window.location.href='/contact'">Schedule¬†a¬†demo</button>
      <p>‚òé¬†+1¬†(814)¬†867‚Äë4095</p>
    </aside>
  </section>

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  DOCSBOT¬†API   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <script>
    /*
      üîë  >>>>  FILL THESE IN  <<<<
    */
    const BOT_ID   = 'YOUR_BOT_ID';
    const API_KEY  = 'DOCSBOT_API_KEY';

    /* Endpoints ‚Äì update if DocsBot changes path structure */
    const BASE_URL     = 'https://api.docsbot.ai';
    const CHAT_URL     = `${BASE_URL}/chat`;
    const SEARCH_URL   = `${BASE_URL}/search`;
    const RATE_URL     = `${BASE_URL}/rate`;      // + /{answerId}

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  DOM refs  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const form         = document.getElementById('searchForm');
    const input        = document.getElementById('queryInput');
    const answerCard   = document.getElementById('answerCard');
    const answerH      = document.getElementById('answerHeading');
    const answerBody   = document.getElementById('answerBody');
    const sourcesUL    = document.getElementById('sources');
    const resultsOL    = document.getElementById('results');
    const loadMoreBtn  = document.getElementById('loadMore');

    let lastAnswerId = null;
    let latestQuery = '';
    let topK = 20;        // batch size for results

    /* Utilities */
    function highlight(text, term){
      return text.replace(new RegExp(term, 'ig'), match=>`<mark>${match}</mark>`);
    }

    async function docsbotFetch(url, body){
      const res = await fetch(url, {
        method:'POST',
        headers:{
          'Content-Type':'application/json',
          'Authorization':`Bearer ${API_KEY}`
        },
        body:JSON.stringify(body)
      });
      if(!res.ok) throw new Error(await res.text());
      return res.json();
    }

    async function getAnswer(q){
      /* Adjust payload according to DocsBot spec */
      return docsbotFetch(CHAT_URL, {
        botId: BOT_ID,
        question: q,
        answerWithSources: true
      });
    }

    async function getResults(q, k){
      return docsbotFetch(SEARCH_URL, {
        botId: BOT_ID,
        query: q,
        top_k: k
      });
    }

    function renderAnswer(answer){
      answerCard.hidden = false;
      answerH.textContent = input.value.trim();
      answerBody.innerHTML = answer.answer;
      sourcesUL.innerHTML = answer.sources.slice(0,3).map(s=>`<li><a href="${s.url}">${s.title}</a></li>`).join('');
      lastAnswerId = answer.id;
    }

    function renderResults(list){
      resultsOL.innerHTML = list.map(chunk=>{
        const title = chunk.title || chunk.url;
        const url   = chunk.url;
        const snippet = highlight(chunk.content.slice(0,160)+'‚Ä¶', latestQuery);
        return `<li class="result"><a class="title" href="${url}">${title}</a><p class="snippet">${snippet}</p></li>`;
      }).join('');
    }

    async function runSearch(q){
      latestQuery = q;
      answerCard.hidden = true;
      resultsOL.innerHTML = '<p>Loading¬†results‚Ä¶</p>';
      try{
        const [answer,res] = await Promise.all([
          getAnswer(q),
          getResults(q, topK)
        ]);
        renderAnswer(answer);
        renderResults(res.results || res.chunks || []);
      }catch(err){
        resultsOL.innerHTML = `<p style="color:red;">Error: ${err.message}</p>`;
      }
    }

    /* Feedback */
    answerCard.addEventListener('click', e=>{
      if(!e.target.classList.contains('feedbackBtn')) return;
      const val = Number(e.target.dataset.val);
      if(!lastAnswerId) return;
      fetch(`${RATE_URL}/${lastAnswerId}`,{
        method:'PUT',
        headers:{'Authorization':`Bearer ${API_KEY}`,'Content-Type':'application/json'},
        body:JSON.stringify({rating:val})
      }).catch(console.error);
    });

    /* Submit */
    form.addEventListener('submit', e=>{
      e.preventDefault();
      const q = input.value.trim();
      if(q) runSearch(q);
    });

    // Optional: pre‚Äëfill from ?q= param
    const qParam = new URLSearchParams(location.search).get('q');
    if(qParam){ input.value = qParam; runSearch(qParam); }
  </script>
</body>
</html>

